<!DOCTYPE html>
<html>
<head>
  <title> New Harmony Features In Node.js </title>
  <link rel="stylesheet" href="/assets/css/railscasts.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
  <section id="post">
    <h1 id="title"> New Harmony Features In Node.js </h1>
    <h4 id="date"> April 17th 2014 </h4>
    <h2 id="overview">Overview</h2>
<p>Lately i tried to play around harmony flag with Node.js and i am going to document everything i have learn here.</p>
<p>So as you know Node.js is built on top of V8 Javascript Engene, and it&#39;s been long that they have started implementing ES6 new features. As you may have guessed you can use ES6 in Node.js too, using <code>--harmony</code> flag.   </p>
<h2 id="setting-things">Setting things</h2>
<p>I will be using Node.js version <code>0.11.12</code>. This version is not stable so you need way to manage multiple versions of Node, for that <a href="https://github.com/creationix/nvm">NVM</a> comes to rescue us.</p>
<p>Installing And setting up NVM is preatty easy: </p>
<pre><code class="lang-bash">curl https://raw.github.com/creationix/nvm/v0.<span class="number">4.0</span>/install.sh | sh
nvm install <span class="number">0.11</span> <span class="comment">#install latest version of node</span>
nvm use <span class="number">0.11</span> <span class="comment">#use v0.11 node version  </span>
nvm alias default <span class="number">0.11</span> <span class="comment">#make it default</span>
</code></pre>
<p>To use some of the ES6 features you need to be in strict mode, Node.js has <code>use-strict</code> flag for that. I suggest to use it every time you run Node.js script. To make things convinient i added node alias in my <code>.zshrc</code> file</p>
<pre><code class="lang-bash">alias node=<span class="string">'node --harmony --use-strict'</span>
</code></pre>
<p>So every time i will run <code>node app.js</code> it will use harmony and strict flags to run my script, Perfect!</p>
<h2 id="new-features">New Features</h2>
<p>To get list of new ES6 features you can use in v0.11, you can run:</p>
<pre><code>node --v8-options | grep harmony

#which gives this list:
<span class="comment">/*</span>
  -<span class="ruby">-harmony_typeof (enable harmony semantics <span class="keyword">for</span> typeof)
</span>  -<span class="ruby">-harmony_scoping (enable harmony block scoping)
</span>  -<span class="ruby">-harmony_modules (enable harmony modules (implies block scoping))
</span>  -<span class="ruby">-harmony_symbols (enable harmony symbols (a.k.a. private names))
</span>  -<span class="ruby">-harmony_proxies (enable harmony proxies)
</span>  -<span class="ruby">-harmony_collections (enable harmony collections (sets, maps, <span class="keyword">and</span> weak maps))
</span>  -<span class="ruby">-harmony_observation (enable harmony object observation (implies harmony collections)
</span>  -<span class="ruby">-harmony_generators (enable harmony generators)
</span>  -<span class="ruby">-harmony_iteration (enable harmony iteration (<span class="keyword">for</span>-of))
</span>  -<span class="ruby">-harmony_numeric_literals (enable harmony numeric literals (0o77, 0b11))
</span>  -<span class="ruby">-harmony_strings (enable harmony string)
</span>  -<span class="ruby">-harmony_arrays (enable harmony arrays)
</span>  -<span class="ruby">-harmony_maths (enable harmony math functions)
</span>  -<span class="ruby">-harmony (enable all harmony features (except typeof))
</span>*/
</code></pre><p>there are lot&#39;s of things to check out, hm really neat!!!</p>
<h2 id="harmony-scoping">Harmony Scoping</h2>
<p>harmony scoping gives us way to define variables in block scope using let keyword,
so lets see example:</p>
<pre><code class="lang-js"><span class="keyword">if</span> (<span class="literal">true</span>){
  <span class="keyword">let</span> x = <span class="string">'donkey'</span>;
  console.log(x); <span class="comment">//donkey</span>
}
console.log(x) <span class="comment">//undefined</span>
</code></pre>
<p>you can see that x is only defined in the block if executed and not visible outside of it. </p>
<h2 id="harmony-generators">Harmony Generators</h2>
<p>Generators let us to stop and resume execution of function. It&#39;s really one of the biggest features in ES6 because using generators and some tricks we can write asyncronius functions without ugly callbecks.</p>
<pre><code class="lang-js"><span class="comment">//defining generator is same as function declaration but adding asterix *</span>
<span class="function"><span class="keyword">function</span>* <span class="title">Fib</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> fb1=<span class="number">0</span>, fb2=<span class="number">1</span>, current;

  <span class="keyword">while</span>(<span class="literal">true</span>) {
    current = fb1 + fb2;
    <span class="keyword">yield</span> current;

    fb1 = fb2;
    fb2 = current;
  }
};

<span class="comment">//this returns just Generator itarable object</span>
<span class="keyword">var</span> numbers = Fib();
<span class="comment">//now we can call next function to get next value and pause function</span>
console.log(numbers.next()); <span class="comment">//{ value: 1, done: false }</span>
console.log(numbers.next());<span class="comment">//{ value: 2, done: false }</span>
console.log(numbers.next());<span class="comment">//{ value: 3, done: false }</span>
</code></pre>
<p>there are lot&#39;s of cool things build on top of generators feature, you can check <a href="http://koajs.com/">Koa.js</a> for example.</p>

  </section>
</body>
</html>
