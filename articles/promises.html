<!DOCTYPE html>
<html>
<head>
  <title> Promises </title>
  <link rel="stylesheet" href="/assets/css/railscasts.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
  <section id="post">
    <h1 id="title"> Promises </h1>
    <h4 id="date"> November 14th 2013 </h4>
    <p>Promises are way to interact with result of asynchronous operation, for example you are doing http request you can return a promise and interact with it instead of registering callback function. Result is nice code structure no callback hells and better error handling.
Best way to learn new things is to implement it by yourself so i made very simple implementation:</p>
<pre><code class="lang-javascript"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span> <span class="params">()</span> {</span>
  <span class="keyword">var</span> fail,then, instance, thenCb, failCb, self = <span class="keyword">this</span>;

  self.resolve =  <span class="function"><span class="keyword">function</span> <span class="params">(data)</span> {</span>
    <span class="keyword">if</span> (thenCb) {
      thenCb(data);
    }
  };
  self.reject =  <span class="function"><span class="keyword">function</span> <span class="params">(error)</span> {</span>
    <span class="keyword">if</span> (failCb) {
      failCb(error);
    }
  };

  instance = {
    fail: <span class="function"><span class="keyword">function</span> <span class="params">(cb)</span> {</span>
      failCb = cb;
      <span class="keyword">return</span> self.get();
    },
    then: <span class="function"><span class="keyword">function</span> <span class="params">(cb)</span> {</span>
      thenCb = cb;
      <span class="keyword">return</span> self.get();
    }
  };

  self.get = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">return</span> instance;
  }
};
</code></pre>
<pre><code class="lang-javascript"><span class="comment">//example usage</span>
<span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);

<span class="function"><span class="keyword">function</span> <span class="title">read</span> <span class="params">(name)</span> {</span>
  <span class="keyword">var</span> promise = <span class="keyword">new</span> Promise();

  fs.readFile(name , <span class="function"><span class="keyword">function</span> <span class="params">(error, data)</span> {</span>
    <span class="keyword">if</span> (error) {
      promise.reject(error);
    }
    <span class="keyword">if</span> (data) {
      promise.resolve(data);
    }
  });

  <span class="keyword">return</span> promise.get();
};

read(<span class="string">'viri.txt'</span>)
  .then(<span class="function"><span class="keyword">function</span> <span class="params">(data)</span> {</span>
    console.log(<span class="string">'wow i got data'</span>);
  })
  .fail(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    console.log(<span class="string">'shit failed'</span>)
  });
</code></pre>

  </section>
</body>
</html>
